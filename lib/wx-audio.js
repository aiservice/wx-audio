var WxAudio = function(i) { function t(A) { if (e[A]) return e[A].exports; var o = e[A] = { i: A, l: !1, exports: {} }; return i[A].call(o.exports, o, o.exports, t), o.l = !0, o.exports; } var e = {}; return t.m = i, t.c = e, t.d = function(i, e, A) { t.o(i, e) || Object.defineProperty(i, e, { enumerable: !0, get: A }); }, t.r = function(i) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(i, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(i, "__esModule", { value: !0 }); }, t.t = function(i, e) { if (1 & e && (i = t(i)), 8 & e) return i; if (4 & e && "object" == typeof i && i && i.__esModule) return i; var A = Object.create(null); if (t.r(A), Object.defineProperty(A, "default", { enumerable: !0, value: i }), 2 & e && "string" != typeof i) for (var o in i) t.d(A, o, function(t) { return i[t]; }.bind(null, o)); return A; }, t.n = function(i) { var e = i && i.__esModule ? function() { return i["default"]; } : function() { return i; }; return t.d(e, "a", e), e; }, t.o = function(i, t) { return Object.prototype.hasOwnProperty.call(i, t); }, t.p = "", t(t.s = 0); }([ function(i, t, e) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var A = function() { function i(i, t) { for (var e = 0; e < t.length; e++) { var A = t[e]; A.enumerable = A.enumerable || !1, A.configurable = !0, "value" in A && (A.writable = !0), Object.defineProperty(i, A.key, A); } } return function(t, e, A) { return e && i(t.prototype, e), A && i(t, A), t; }; }(); e(3); var o = e(1), n = e(2), r = function() { function i(t) { !function(i, t) { if (!(i instanceof t)) throw new TypeError("Cannot call a class as a function"); }(this, i), this.opt = Object.assign({}, { ele: null, width: '100%', title: 'title', src: '', disc: '', autoplay: false, loop: true, ended: function () {} }, t), "string" == typeof this.opt.ele && (this.opt.ele = document.querySelector(this.opt.ele)), this.opt.ele && (this.loading = !1, this.isDrag = !1, this.isplaying = !1, this.durationT = 0, this.currentT = 0, this.currentP = 0, this.maxProgressWidth = 0, this.dragProgressTo = 0, this.reduceTBefore = 0, this.reduceTAfter = 0, this.initDom()); } return A(i, [ { key: "initDom", value: function() { this.wxAudioC = document.createElement('div'); this.wxAudioC.className = 'wx-audio-content'; this.wxAudioC.style.width = this.opt.width; this.opt.ele.appendChild(this.wxAudioC); this.wxAudio = document.createElement('audio'); this.wxAudio.className = 'wx-audio-content'; this.wxAudio.src = this.opt.src; if (this.opt.loop) this.wxAudio.setAttribute('loop', this.opt.loop); this.wxAudioC.appendChild(this.wxAudio); this.wxAudioR = document.createElement('div'); this.wxAudioR.className = 'wx-audio-right'; this.wxAudioC.appendChild(this.wxAudioR); this.wxAudioT = document.createElement('p'); this.wxAudioT.className = 'wx-audio-title'; this.wxAudioT.innerText = this.opt.title; this.wxAudioR.appendChild(this.wxAudioT); this.wxAudioP = document.createElement('div'); this.wxAudioP.className = 'wx-audio-progrees'; this.wxAudioR.appendChild(this.wxAudioP); this.wxAudioDetail = document.createElement('div'); this.wxAudioDetail.className = 'wx-progrees-detail'; this.wxAudioP.appendChild(this.wxAudioDetail); this.wxAudioL = document.createElement('div'); this.wxAudioL.className = 'wx-audio-left'; this.wxAudioC.appendChild(this.wxAudioL); this.wxAudioStateImg = document.createElement('em'); this.wxAudioStateImg.className = 'weui-audio-btn'; this.wxAudioL.appendChild(this.wxAudioStateImg); this.wxVoiceP = document.createElement('span'); this.wxVoiceP.className = 'wx-voice-p'; this.wxAudioDetail.appendChild(this.wxVoiceP); this.wxBufferP = document.createElement('span'); this.wxBufferP.className = 'wx-buffer-p'; this.wxAudioDetail.appendChild(this.wxBufferP); this.wxLoading = document.createElement('span'); this.wxLoading.className = 'wx-loading'; this.wxAudioDetail.appendChild(this.wxLoading); this.wxLoadingWrapper = document.createElement('span'); this.wxLoadingWrapper.className = 'wx-loading-wrapper'; this.wxLoading.appendChild(this.wxLoadingWrapper); this.wxAudioOrigin = document.createElement('div'); this.wxAudioOrigin.className = 'wx-audio-origin'; this.wxAudioP.appendChild(this.wxAudioOrigin); this.wxAudioTime = document.createElement('div'); this.wxAudioTime.className = 'wx-audio-time'; this.wxAudioR.appendChild(this.wxAudioTime); this.wxAudioCurrent = document.createElement('span'); this.wxAudioCurrent.className = 'current-t'; this.wxAudioCurrent.innerText = '00:00'; this.wxAudioTime.appendChild(this.wxAudioCurrent); this.wxAudioDuration = document.createElement('span'); this.wxAudioDuration.className = 'duration-t'; this.wxAudioDuration.innerText = '00:00'; this.wxAudioTime.appendChild(this.wxAudioDuration); this.initAudioEvent(); if (this.opt.autoplay) { document.addEventListener('WeixinJSBridgeReady', () => { this.audioPlay(); }) } } }, { key: "audioPlay", value: function() { this.wxAudio.play(), this.isPlaying = !0; } }, { key: "audioPause", value: function() { this.wxAudio.pause(), this.isPlaying = !1; } }, { key: "audioPlayPause", value: function() { this.isPlaying ? this.audioPause() : this.audioPlay(); } }, { key: "audioCut", value: function(i, t, e) { this.wxAudio.src = i, this.wxAudioT.innerText = t, this.wxAudioD.innerText = e, this.durationT = 0, this.currentT = 0, this.currentP = 0, this.dragProgressTo = 0, this.wxAudioCurrent.innerText = "00:00", this.wxAudioOrigin.style.left = "0px", this.wxVoiceP.style.width = "0px", this.audioPlay(); } }, { key: "showLoading", value: function(i) { this.loading = i || !1, this.loading ? this.wxLoading.style.display = "block" : this.wxLoading.style.display = "none"; } }, { key: "initAudioEvent", value: function() { var _this = this; _this.wxAudio.onplaying = function () { var date = new Date (); _this.isPlaying = true; _this.reduceTBefore = Date.parse(date) - Math.floor(_this.wxAudio.currentTime * 1000); _this.wxAudioStateImg.className += " weui-audio-btn_playing"; }, _this.wxAudio.onpause = function () { _this.isPlaying = false; _this.showLoading(false); _this.wxAudioStateImg.className = "weui-audio-btn"; }, _this.wxAudio.onloadedmetadata = function () { _this.durationT = _this.wxAudio.duration; _this.wxAudioDuration.innerText = _this.formartTime(_this.wxAudio.duration); }, _this.wxAudio.onwaiting = function () { if(!_this.wxAudio.paused) { _this.showLoading(true); } }, _this.wxAudio.onprogress = function () { if(_this.wxAudio.buffered.length > 0) { var bufferedT = 0; for (var i = 0; i < _this.wxAudio.buffered.length; i++) { bufferedT += _this.wxAudio.buffered.end(i) - _this.wxAudio.buffered.start(i); if(bufferedT > _this.durationT) { bufferedT = _this.durationT; _this.showLoading(false); console.log('缓冲完成'); } } var bufferedP = Math.floor((bufferedT / _this.durationT) * 100); _this.wxBufferP.style.width = bufferedP + '%'; } var date = new Date (); if(!_this.wxAudio.paused) { _this.reduceTAfter = Date.parse(date) - Math.floor(_this.currentT * 1000); if(_this.reduceTAfter - _this.reduceTBefore > 1000) { _this.showLoading(true); } else { _this.showLoading(false); } } else { return; } }, _this.wxAudio.onended = function () { _this.opt.ended(); }, _this.wxAudio.ontimeupdate = function () { var date = new Date (); if (!_this.isDrag) { _this.currentT = _this.wxAudio.currentTime; _this.currentP = Number((_this.wxAudio.currentTime / _this.durationT) * 100); _this.reduceTBefore = Date.parse(date) - Math.floor(_this.currentT * 1000); _this.currentP = _this.currentP > 100 ? 100 : _this.currentP; _this.wxVoiceP.style.width = _this.currentP + '%'; _this.wxAudioOrigin.style.left = _this.currentP + '%'; _this.wxAudioCurrent.innerText = _this.formartTime(_this.wxAudio.currentTime); _this.showLoading(false); } }, _this.wxAudioStateImg.onclick = function () { _this.audioPlayPause(); }, _this.wxAudioOrigin.onmousedown = function (event) { _this.isDrag = true; var e = event || window.event; var x = e.clientX; var l = event.target.offsetLeft; _this.maxProgressWidth = _this.wxAudioDetail.offsetWidth; _this.wxAudioC.onmousemove = function (event) { if (_this.isDrag) { var e = event || window.event; var thisX = e.clientX; _this.dragProgressTo = Math.min(_this.maxProgressWidth, Math.max(0, l + (thisX - x))); _this.updatePorgress(); } }, _this.wxAudioC.onmouseup = function () { if (_this.isDrag) { _this.isDrag = false; _this.wxAudio.currentTime = Math.floor(_this.dragProgressTo / _this.maxProgressWidth * _this.durationT); } else { return; } }, _this.wxAudioC.onmouseleave = function () { if (_this.isDrag) { _this.isDrag = false; _this.wxAudio.currentTime = Math.floor(_this.dragProgressTo / _this.maxProgressWidth * _this.durationT); } else { return; } } }, _this.wxAudioOrigin.ontouchstart = function (event) { _this.isDrag = true; var e = event || window.event; var x = e.touches[0].clientX; var l = e.target.offsetLeft; _this.maxProgressWidth = _this.wxAudioDetail.offsetWidth; _this.wxAudioC.ontouchmove = function (event) { if (_this.isDrag) { var e = event || window.event; var thisX = e.touches[0].clientX; _this.dragProgressTo = Math.min(_this.maxProgressWidth, Math.max(0, l + (thisX - x))); _this.updatePorgress(); } }, _this.wxAudioC.ontouchend = function () { if (_this.isDrag) { _this.isDrag = false; _this.wxAudio.currentTime = Math.floor(_this.dragProgressTo / _this.maxProgressWidth * _this.durationT); } else { return; } } }, _this.wxAudioDetail.onclick = function (event) { var e = event || window.event; var l = e.layerX; var w = _this.wxAudioDetail.offsetWidth; _this.wxAudio.currentTime = Math.floor(l / w * _this.durationT); } } }, { key: "isWeiXin", value: function() { var i = window.navigator.userAgent.toLowerCase(); return "micromessenger" === String(i.match(/MicroMessenger/i)); } }, { key: "updatePorgress", value: function() { this.wxAudioOrigin.style.left = this.dragProgressTo + "px", this.wxVoiceP.style.width = this.dragProgressTo + "px"; var i = Math.floor(this.dragProgressTo / this.maxProgressWidth * this.durationT); this.wxAudioCurrent.innerText = this.formartTime(i); } }, { key: "formartTime", value: function(i) { var t = function(i) { return (i = i.toString())[1] ? i : "0" + i; }, e = Math.floor(i / 60), A = Math.floor(i % 60); return t(e) + ":" + t(A); } } ]), i; }(); t["default"] = r; }, function(i, t) { i.exports = ""; }, function(i, t) { i.exports = ""; }, function(i, t) {} ])["default"];